<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <record id="uniacme_voting_process_view_tree" model="ir.ui.view">
            <field name="name">uniacme_voting_process_view_tree</field>
            <field name="model">voting.process</field>
            <field name="arch" type="xml">
                <list decoration-muted="active == False">
                    <field name="description" options='{"text-decoration": "line-through: active == False"}'/>
                    <field name="country_id" options='{"text-decoration": "line-through: active == False"}'/>
                    <field name="tz" options='{"text-decoration": "line-through: active == False"}'/>
                    <field name="date_start" options='{"text-decoration": "line-through: active == False"}'/>
                    <field name="date" options='{"text-decoration": "line-through: active == False"}'/>
                    <field name="candidate_ids" options='{"text-decoration": "line-through: active == False"}'/>
                    <field name="state" options='{"text-decoration": "line-through: active == False"}'/>
                    <field name="active" column_invisible="1"/>
                </list>
            </field>
        </record>

        <record id="uniacme_voting_process_view_form" model="ir.ui.view">
            <field name="name">uniacme_voting_process_view_form</field>
            <field name="model">voting.process</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <field name="state" widget="statusbar" options="{'clickable': '1', 'fold_field': 'fold'}"/>
                        <button name="start_voting" type="object" string="Start Process" class="btn-primary" invisible="state != 'draft'"/>
                    </header>
                    <sheet>
                        <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active"/>
                        <field name="active" invisible="1"/>
                        <group>
                            <field name="description"/>
                        </group>
                        <group>
                            <group>
                                <field name="candidate_ids" widget="many2many_avatar_user"
                                    context="{'default_partner_type': 'candidate'}"/>
                            </group>
                            <group>
                                <field name="country_id"/>
                                <field name="tz"/>
                                <field name="date_start" string="Planned Date" widget="daterange" options="{&quot;end_date_field&quot;: &quot;date&quot;, &quot;always_range&quot;: &quot;1&quot;}" required="date_start or date"/>
                                <field name="date" invisible="1" required="date_start"/>
                            </group>
                        </group>
                    </sheet>
                    <chatter reload_on_post="True"/>
                </form>
            </field>
        </record>

        <record id="uniacme_voting_process_kanban" model="ir.ui.view">
            <field name="name">uniacme_voting_process_kanban</field>
            <field name="model">voting.process</field>
            <field name="arch" type="xml">
                <kanban>
                    <field name="description"/>
                    <field name="state"/>
                    <field name="candidate_vote_info"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <strong><t t-esc="record.description.value"/></strong>
                                <div>
                                    <span>State: <t t-esc="record.state.value"/></span>
                                </div>
                                <div>
                                    <t t-if="record.candidate_vote_info.raw_value.length">
                                        <t t-foreach="record.candidate_vote_info.raw_value" t-as="candidate">
                                            <div style="margin-block-start:10px;">
                                                <img t-att-src="'/web/image/res.partner/' + ('' + candidate[0]) + '/image_1920'" t-att-alt="'Photo of ' + ('' + candidate[1])" style="block-size:48px;inline-size:48px;border-radius:50%;margin-inline-end:8px;vertical-align:middle;"/>
                                                <span style="font-weight:bold;"> <t t-esc="candidate[1]"/> </span>
                                                <span style="margin-inline-start:10px; color:#007bff;">Votes: <t t-esc="candidate[2]"/></span>
                                            </div>
                                        </t>
                                    </t>
                                    <t t-if="!record.candidate_vote_info.raw_value.length">
                                        <div>There are no candidates for this process.</div>
                                    </t>
                                </div>
                                <div>
                                    <button type="object"
                                            name="start_voting"
                                            string="Start Process"
                                            class="btn btn-primary btn-sm mt-2"
                                            invisible="state != 'draft'"/>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="uniacme_voting_process_action" model="ir.actions.act_window">
            <field name="name">Voting Process</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">voting.process</field>
            <field name="view_mode">kanban,list,form</field>
            <field name="context">{'open_from_menu': True}</field>
        </record>

         <record id="action_start_voting_process" model="ir.actions.server">
            <field name="name">Start Voting Process</field>
            <field name="model_id" ref="model_voting_process"/>
            <field name="binding_model_id" ref="model_voting_process"/>
            <field name="binding_view_types">list,form</field>
            <field name="state">code</field>
            <field name="code">
                for record in records:
                    record.start_voting()
            </field>
        </record>

        <record id="view_uniacme_voting_line_pivot" model="ir.ui.view">
            <field name="name">uniacme.voting.line.pivot</field>
            <field name="model">voting.line</field>
            <field name="arch" type="xml">
                <pivot string="Votes by Candidate and Process">
                    <field name="candidate_id" type="row"/>
                    <field name="process_id" type="col"/>
                </pivot>
            </field>
        </record>

        <record id="uniacme_voting_line_action" model="ir.actions.act_window">
            <field name="name">Voting Line</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">voting.line</field>
            <field name="view_mode">pivot</field>
            <field name="context">{'open_from_menu': True}</field>
        </record>
    </data>
</odoo>